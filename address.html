<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Delivery Addresses</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 min-h-screen text-gray-800">
    <div class="max-w-2xl mx-auto my-10 p-6 bg-white shadow-xl rounded-2xl">
      <h2 class="text-2xl font-bold mb-2 text-center" id="user-name-heading">
        Delivery Addresses
      </h2>
      <h3 class="text-lg font-semibold mb-6 text-center" id="user-name"></h3>

      <!-- Add/Edit Address Form -->
      <form id="address-form" class="space-y-4 mb-8">
        <input type="hidden" id="address-id" />
        <div>
          <label class="block text-sm font-medium mb-1" for="address-line"
            >Address Line</label
          >
          <input
            id="address-line"
            type="text"
            class="w-full border rounded px-3 py-2"
            required
          />
        </div>
        <div class="flex gap-4">
          <div class="flex-1">
            <label class="block text-sm font-medium mb-1" for="city"
              >City</label
            >
            <input
              id="city"
              type="text"
              class="w-full border rounded px-3 py-2"
              required
            />
          </div>
          <div class="flex-1">
            <label class="block text-sm font-medium mb-1" for="state"
              >State</label
            >
            <input
              id="state"
              type="text"
              class="w-full border rounded px-3 py-2"
              required
            />
          </div>
        </div>
        <div class="flex gap-4">
          <div class="flex-1">
            <label class="block text-sm font-medium mb-1" for="zip"
              >Zip Code</label
            >
            <input
              id="zip"
              type="text"
              class="w-full border rounded px-3 py-2"
              required
            />
          </div>
          <div class="flex-1">
            <label class="block text-sm font-medium mb-1" for="country"
              >Country</label
            >
            <input
              id="country"
              type="text"
              class="w-full border rounded px-3 py-2"
              required
            />
          </div>
        </div>
        <button
          type="submit"
          class="bg-blue-600 text-white px-5 py-2 rounded hover:bg-blue-700 transition w-full"
          id="submit-btn"
        >
          Add Address
        </button>
        <button
          type="button"
          class="hidden bg-gray-400 text-white px-5 py-2 rounded hover:bg-gray-500 transition w-full mt-2"
          id="cancel-btn"
        >
          Cancel Edit
        </button>
      </form>

      <!-- Address List -->
      <div>
        <h3 class="text-lg font-semibold mb-3">Saved Addresses</h3>
        <ul id="address-list" class="space-y-4">
          <!-- Addresses will be rendered here -->
        </ul>
      </div>
    </div>
    <!-- AXIOS CDN -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
      let user;
      axios
        .get(
          "https://core.hisend.hunnovate.com/api/v1/projects/e_commerce_app/auth/user?api_key=lntX8uGyhVAYkJQTLMHDDXGQ",
          {
            headers: {
              Authorization: "Bearer " + sessionStorage.getItem("token"),
            },
          }
        )
        .then((response) => {
          user = response.data.data;
          document.getElementById("user-name").textContent = user.full_name;
        })
        .catch((error) => {
          //redirect to login if token is invalid
          if (error.response && error.response.status === 401) {
            alert("Unable to get authenticated user. Please log in again.");
            window.location.href = "login.html";
          }
        });

      const submitForm = () => {
        axios.post(
          `https://core.hisend.hunnovate.com/api/v1/projects/e_commerce_app/tables/user_addresses/records?api_key=lntX8uGyhVAYkJQTLMHDDXGQ`,
          {
            address_line: document.getElementById("address-line").value,
            city: document.getElementById("city").value,
            state: document.getElementById("state").value,
            zip: document.getElementById("zip").value,
            country: document.getElementById("country").value,
          },
          {
            headers: {
              Authorization: "Bearer " + sessionStorage.getItem("token"),
            },
          }
        )
        .then((response) => {
          alert("Address added successfully!");
          document.getElementById("address-form").reset();
          // Optionally, you can refresh the address list here
        })
        .catch((error) => {
          alert(error.response?.data?.message || "Error adding address");
          console.error("Error adding address:", error);
        });
      };

      document.getElementById("address-form").addEventListener("submit", (e) => {
        e.preventDefault();
        submitForm();
      });

    </script>
  </body>
</html>
